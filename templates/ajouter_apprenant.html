{%extends 'accueil.html'%} 
{%block corps%}    

   <!-- Formulaire -->
   <form class="ui form" style="width:50%" method = "POST">
      <h4 class="ui dividing header" style="text-align:center">AJOUTER UN APPRENANT</h4>
      <!-- Bouton radio -->
      <div class="inline fields" style="margin-left:220px">
         <div class="field">
            <div class="ui radio checkbox">
               <input type="radio" name="etat" onclick="lireInput()"  >
               <label>Nouveau</label>
            </div>
         </div>
         <div class="field">
            <div class="ui radio checkbox">
               <input type="radio" name="etat" id="ancien" onclick="writeInput()" > 
               <label>Ancien</label>
            </div>
         </div>
      </div>
      <!------------------------------------ Partie Etudiant --------------------------------------------->
      <div class="ui raised segment">
            <legend style="text-align:center">Etudiant</legend>

         <!-- Champ matricule -->
         <div class="two fields">      
            <div class="field">
               <label>Matricule</label>
               <input type="text" name="matricule" readonly="true" id="mat" value="{{gen_mat}}">
            </div>
         </div>
         <!-- Champ prenom et nom -->
         <div class="two fields">      
            <div class="required field">
               <label>Prénom</label>
               <input type="text" name="prenom" placeholder="Prénom" value="{{prenom}}" pattern=".*\S.*">
            </div>
               
            <div class="required field">
               <label>Nom</label>
               <input type="text" name="nom" placeholder="Nom de famille" value="{{nom}}" pattern=".*\S.*">
            </div>
         </div>

         <!-- Combox genre -->
         <div class="two fields">
            <div class="required field">
               <label>Sexe</label>
               <select class="ui fluid dropdown" name="sexe">
                  <option value="">Choisir genre</option>
                  <option value="Masculin">Masculin</option>
                  <option value="Féminin">Féminin</option> 
               </select>
            </div>   
         </div>  

         <!-- Champ date naissance et lieu de naissance -->
         <div class="two fields">
            <div class="required field">
               <label>Date de naissance</label>
               <input type="date" name="date_naissance" max="2005-01-01" value="{{ date_naissance }}">
            </div>    
            <div class="required field">
               <label>Lieu de naissance</label>
               <input type="text" name="lieu_naissance" placeholder="Lieu de naissance" value="{{ lieu_naissance }}">
            </div>
         </div>

         <!-- Champ adresse -->
         <div class="two fields" id="">
            <div class="required field">
               <label>Adresse</label>
               <input type="text" name="adresse" placeholder="ville" value="{{ adresse }}">
            </div>
         </div>
         
         <!-- Champ contact -->
         <div class="two fields">
            <div class="required field">
               <label>E-mail</label>
               <input type="email" name="email" placeholder="mamadou@gmail.com" value="{{ email }}">
            </div>    
            <div class="required field">
               <label>Téléphone : <em> format(xx-xxx-xx-xx)</em></label>
               <input type="tel" pattern="[0-9]{2}-[0-9]{3}-[0-9]{2}-[0-9]{2}"
                  name="telephone" placeholder="xx-xxx-xx-xx" value="{{ telephone }}">
            </div>
         </div>
      </div>
      <!------------------------------------ FIn Partie Etudiant --------------------------------------------->
      
      <!--------------------------------------- Partie Inscription --------------------------------------------->
      <div class="ui raised segment">
         <legend style="text-align:center">Inscription</legend>

         <!-- Combox Filière -->
         <div class="two fields">
            <div class="required field">
               <label>Filière</label>
               <select class="ui fluid dropdown" name="filiere" id="fil" >
                  <option value="">Choisir filière</option>
                  {% for val in filieres %}
                     <option value="{{ val[0] }}">{{ val[1] }}</option>
                  {% endfor %} 
               </select>
            </div>   
         </div>  
         <!-- Combox Classe -->
         <div class="two fields">
            <div class="required field">
               <label>Classe</label>
               <select class="ui fluid dropdown" name="classe" id="classe">
                  <option value="">Choisir classe</option>
               </select>
            </div>   
         </div> 
         <!-- Montant inscription -->
         <div class="two fields">      
            <div class="field">
               <label>Montant inscription</label>
               <input type="text" name="prenom" readonly="true" value="{{prenom}}">
            </div>
         </div>
         <!-- Champ prenom et nom -->
         <div class="two fields">      
            <div class="field">
               <label>Mensualité</label>
               <input type="text" name="prenom" readonly="true" value="{{prenom}}">
            </div>
         </div>
         <!-- Champ adresse -->
         <div class="two fields" id="">
            <div class="field">
               <label>Total inscription</label>
               <input type="text" name="adresse" readonly="true" value="{{ adresse }}">
            </div>
         </div>
         <!-- Date d'inscription -->
         <div class="two fields">
            <div class="required field">
               <label>Date d'inscription</label>
               <input type="date" name="date_ins" value="{{ date_naissance }}">
            </div>    
         </div>
         <!-- Année Académique -->
         <div class="two fields">      
            <div class="field">
               <label>Année académique</label>
               <input type="text" name="annee_ac" readonly="true" value="{{annee_academy}}">
            </div>
         </div>
      </div>
      <!------------------------------------ Fin Partie Inscription --------------------------------------------->
      
      <!------------------------------------ Partie Bouton --------------------------------------------->
      <div class="two fields">
         <div class="field" style="width:auto">
            <button type="submit"  value="ajout_app" class="btn btn-primary" style="background:#328f8e; border: #328f8e; width: 95px; margin-top:8px ">Enregistrer</button>
         </div>
      </div>

      {% with messages = get_flashed_messages() %}
         {% for message in messages %} 
         <script>
            var someJavaScriptVar = '{{ message }}';
         </script>

            {% if message%}
               {% if message=="WARNING : L'apprenant existe déjà" %}
               <script type="text/javascript">
                  $('#btnDangerCenter').ready(function() {
                     $.uiAlert({
                        textHead: someJavaScriptVar,
                        text: '', // Text
                        bgcolor: '#DB2828', // background-color
                        textcolor: '#fff', // color
                        position: 'top-center',// position . top And bottom ||  left / center / right
                        time: 3, // time
                     })
                  });
               </script>
               {% else %}
                  <script type="text/javascript">
                     $('#btnDangerCenter').ready(function() {
                        $.uiAlert({
                           textHead: someJavaScriptVar,
                           text: '', // Text
                           bgcolor: '#19c3aa', // background-color
                           textcolor: '#fff', // color
                           position: 'top-center',// position . top And bottom ||  left / center / right
                           time: 3, // time
                        })
                     });
                  </script>
               {%endif%}
            {%endif%}
         {% endfor %}      
      {% endwith %}
      <!-- Script pour la validation des champs -->
      <script>
         $('.ui.form')
         .form({
            fields: {
               prenom         : 'empty',
               nom            : 'empty',
               sexe           : 'empty',
               date_naissance : 'empty',
               lieu_naissance : 'empty',
               adresse        : 'empty',
               email          : 'empty',
               telephone      : 'empty',
               promo          : 'empty',
            }
         });           
      </script>
      <script>  
         $('.ui.radio.checkbox')
            .checkbox(); 
      </script>

      <script>
         function writeInput() {          
            $('#mat').attr('readonly', false);         
         } 
         function lireInput() {          
            $('#mat').attr('readonly', true);         
         }
      </script>

      <script type="text/javascript">
         $( document ).ready(function() {
            $('#fil').change(function(){ 
               var x = document.getElementById("fil").value;
               $('#classe').children('option:not(:first)').remove();
               /*document.getElementById("response").innerHTML = "You selected: " + x;*/
               $.ajax({ 
                  type: "GET",
                  url: "http://127.0.0.1:5000/filiere&"+x,
               });
            });
         });

         $( document ).ready(function() {
            $('#fil').change(function(){ 
               var x = document.getElementById("fil").value;
               $.ajax({ 
                  type: "GET",
                  contentType: 'application/json; charset=utf-8',
                  url: "http://127.0.0.1:5000/filiere&"+x,
                  success: function(liste_classe){
                     $('#classe').children('option:not(:first)').remove();
                     $.each(liste_classe,function(index,d){
                        /* $('#fil').append('Prénom : ' + d.Prenom); */         
                        /* var selection = document.getElementById("classe");
                        selection.options[selection.options.length] = new Option(d.libelle, d.id);*/   
                        $("#classe").append("<option value=' d.id '>" + d.libelle + "</option>");
                     });
                  }
               });
            });
         });

         /********************************AJAX CLASSE****************************/
         $( document ).ready(function() {
            $('#classe').change(function(){ 
               var x = document.getElementById("classe").value;
               /*document.getElementById("response").innerHTML = "You selected: " + x;*/
               $.ajax({ 
                  type: "GET",
                  url: "http://127.0.0.1:5000/filiere&"+x,
               });
            });
         });

         $( document ).ready(function() {
            $('#fil').change(function(){ 
               var x = document.getElementById("fil").value;
               $.ajax({ 
                  type: "GET",
                  contentType: 'application/json; charset=utf-8',
                  url: "http://127.0.0.1:5000/filiere&"+x,
                  success: function(liste_classe){
                     $('#classe').children('option:not(:first)').remove();
                     $.each(liste_classe,function(index,d){
                        /* $('#fil').append('Prénom : ' + d.Prenom); */         
                        /* var selection = document.getElementById("classe");
                        selection.options[selection.options.length] = new Option(d.libelle, d.id);*/   
                        $("#classe").append("<option value=' d.id '>" + d.libelle + "</option>");
                     });
                  }
               });
            });
         });
      </script>
<!--  <script src="https://code.jquery.com/jquery-2.1.4.js"></script>
 -->     
 
   </form>
   <div id="response"></div>

{%endblock%}   
